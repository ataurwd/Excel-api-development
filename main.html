<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPAC Listings</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      tbody tr:hover {
        background-color: #f3f4f6;
      }

      .status-liquidated {
        color: #dc2626;
        font-weight: 600;
      }
      .status-active {
        color: #16a34a;
        font-weight: 600;
      }

      .page-btn {
        padding: 6px 10px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
      }

      .page-btn:hover {
        background-color: #f3f4f6;
      }

      .active-page {
        background-color: #2563eb;
        color: white;
        border-color: #2563eb;
      }

      .disabled {
        opacity: 0.4;
        pointer-events: none;
      }
    </style>
  </head>

  <body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
      <h1 class="md:text-5xl text-3xl font-bold text-center mb-8">
        Mapping the world's SPAC Markets
      </h1>
      <p class="font-bold text-center mb-6">
        The source of record on special purpose acquisition companies, listings,
        sponsors, and market intelligence globally.
      </p>

      <!-- TABLE -->
      <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-left"
                >
                  #
                </th>
                <th
                  class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-left"
                >
                  Name
                </th>
                <th
                  class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-left"
                >
                  Price
                </th>
                <th
                  class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-left"
                >
                  Volume
                </th>
                <th
                  class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-left"
                >
                  Status
                </th>
                <th class="px-6 py-3"></th>
              </tr>
            </thead>

            <tbody id="spac-table-body" class="">
              <tr>
                <td colspan="6" class="text-center py-10 text-gray-500">
                  Loading data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- PAGINATION FOOTER -->
      <div class="flex items-center justify-between mt-6 px-2">
        <p id="resultInfo" class="text-sm text-gray-600"></p>
        <div id="pagination" class="flex items-center gap-1 flex-wrap"></div>
      </div>
    </div>

    <script>
      const PER_PAGE = 20;
      const TOTAL_ITEMS = 1392; // backend / wp header / fixed
      const TOTAL_PAGES = Math.ceil(TOTAL_ITEMS / PER_PAGE);

      let currentPage = 1;

      async function fetchPage(page) {
        const res = await fetch(
          `https://spaclisting.com/wp-json/wp/v2/pages?per_page=${PER_PAGE}&page=${page}`
        );
        if (!res.ok) return [];
        return await res.json();
      }

      function parseSpacDetails(content) {
        const ulStart = content.indexOf("<ul>");
        if (ulStart === -1) return null;

        const ulEnd = content.indexOf("</ul>", ulStart);
        const html = content.substring(ulStart, ulEnd + 5);

        const doc = new DOMParser().parseFromString(html, "text/html");
        const liItems = doc.querySelectorAll("li");

        const details = {};
        liItems.forEach((li) => {
          const strong = li.querySelector("strong");
          if (strong) {
            const key = strong.textContent.replace(":", "").trim();
            const value = li.textContent.replace(strong.textContent, "").trim();
            details[key] = value || "N/A";
          }
        });

        if (!details.Ticker) return null;
        return details;
      }

      async function loadPage(page) {
        currentPage = page;

        const tbody = document.getElementById("spac-table-body");
        tbody.innerHTML = `
      <tr>
        <td colspan="6" class="text-center py-10 text-gray-500">Loading...</td>
      </tr>
    `;

        const data = await fetchPage(page);
        tbody.innerHTML = "";

        data.forEach((p, i) => {
          if (!p.content?.rendered) return;
          const d = parseSpacDetails(p.content.rendered);
          if (!d) return;
            console.log(p.title.rendered)
          let statusText = "Active";
          let statusClass = "status-active";

          if (d.Stage?.includes("Liquidated")) {
            statusText = "Liquidated";
            statusClass = "status-liquidated";
          }

          const tr = document.createElement("tr");
          tr.innerHTML = `
        <td class="px-6 py-4">${(page - 1) * PER_PAGE + i + 1}</td>
        <td class="px-6 py-4 font-medium">
          ${p.title.rendered.length > 15 ? p.title.rendered.slice(0, 45) + "..." : p.title.rendered}
        </td>
        <td class="px-6 py-4">${d.Price || "N/A"}</td>
        <td class="px-6 py-4">${d.Volume || "N/A"}</td>
        <td class="px-6 py-4">${statusText}</td>
        <td class="px-6 py-4">
          <a href="${p.link}" target="_blank" class="text-blue-600 underline">
            View
          </a>
        </td>
      `;
          tbody.appendChild(tr);
        });

        updateResultInfo();
        renderPagination();
      }

      function updateResultInfo() {
        const start = (currentPage - 1) * PER_PAGE + 1;
        const end = Math.min(currentPage * PER_PAGE, TOTAL_ITEMS);

        document.getElementById(
          "resultInfo"
        ).innerText = `Showing ${start}â€“${end} of ${TOTAL_ITEMS} results`;
      }

      function renderPagination() {
        const container = document.getElementById("pagination");
        container.innerHTML = "";

        const createBtn = (label, page, extraClass = "") => {
          const btn = document.createElement("button");
          btn.innerText = label;
          btn.className = `page-btn ${extraClass}`;
          btn.onclick = () => loadPage(page);
          return btn;
        };

        container.appendChild(
          createBtn(
            "Prev",
            currentPage - 1,
            currentPage === 1 ? "disabled" : ""
          )
        );

        for (let i = 1; i <= TOTAL_PAGES; i++) {
          if (
            i === 1 ||
            i === TOTAL_PAGES ||
            (i >= currentPage - 2 && i <= currentPage + 2)
          ) {
            container.appendChild(
              createBtn(i, i, i === currentPage ? "active-page" : "")
            );
          } else if (i === currentPage - 3 || i === currentPage + 3) {
            const dots = document.createElement("span");
            dots.innerText = "...";
            dots.className = "px-2";
            container.appendChild(dots);
          }
        }

        container.appendChild(
          createBtn(
            "Next",
            currentPage + 1,
            currentPage === TOTAL_PAGES ? "disabled" : ""
          )
        );
      }

      loadPage(1);
    </script>
  </body>
</html>
